@model IEnumerable<ChurchHub.Intention>
@{
    ViewBag.Title = "Intentions";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@*Pending *@
<div class="card">
    <h5 class="card-header">Pending Intentions</h5>
    <div class="table-responsive text-nowrap">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Offered By</th>
                    <th>Intention Type</th>
                    <th>Intention Date</th>
                    <th>Mass Time</th>
                    <th>Intention Details</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody class="table-border-bottom-0">
                @foreach (var item in Model.Where(m => m.intentionStatus == 0))
                {
                    <tr>
                        <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>@Html.DisplayFor(modelItem => item.offeredBy)</strong></td>
                        <td>
                            @if (item.intentionType == 1)
                            {
                                <span>Souls</span>
                            }
                            else if (item.intentionType == 2)
                            {
                                <span>Thanksgiving</span>
                            }
                            else if (item.intentionType == 3)
                            {
                                <span>Healing</span>                           
                            }
                        </td>                       
                        <td>@Html.DisplayFor(modelItem => item.intentionDate)</td>
                        <td>@Html.DisplayFor(modelItem => item.massTime)</td>
                        <td>@Html.DisplayFor(modelItem => item.intentionDetails)</td>
                        <td>
                            @if (item.intentionStatus == 0)
                            {
                                <span class="badge bg-label-warning me-1">Pending</span>
                            }
                            else if(item.intentionStatus == 1)
                            {
                                <span class="badge bg-label-info me-1">Scheduled</span>
                            }
                            else if (item.intentionStatus == 2)
                            {
                                <span class="badge bg-label-success me-1">Complete</span>
                            }
                        </td>                        
                        <td>
                            <button type="button" class="btn btn-outline-secondary" onclick="AcceptIntentions(@item.intentionId)" >Accept</button>
                            <button type="button" class="btn btn-outline-danger" onclick="confirmDelete(@item.intentionId)">Delete</button>                           
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<br />
<br />
@*Sheduled *@
<div class="card">
    <h5 class="card-header">Scheduled Intentions</h5>
    <div class="table-responsive text-nowrap">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Offered By</th>
                    <th>Intention Type</th>
                    <th>Intention Date</th>
                    <th>Mass Time</th>
                    <th>Intention Details</th>
                    <th>Status</th>
                    <th>Action</th>

                </tr>
            </thead>
            <tbody class="table-border-bottom-0">
                @foreach (var item in Model.Where(m => m.intentionStatus == 1))
                {
                    <tr>
                        <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>@Html.DisplayFor(modelItem => item.offeredBy)</strong></td>
                        <td>
                            @if (item.intentionType == 1)
                            {
                                <span>Souls</span>
                            }
                            else if (item.intentionType == 2)
                            {
                                <span>Thanksgiving</span>
                            }
                            else if (item.intentionType == 3)
                            {
                                <span>Healing</span>
                            }
                        </td>
                        <td>@Html.DisplayFor(modelItem => item.intentionDate)</td>
                        <td>@Html.DisplayFor(modelItem => item.massTime)</td>
                        <td>@Html.DisplayFor(modelItem => item.intentionDetails)</td>
                        <td>
                            @if (item.intentionStatus == 0)
                            {
                                <span class="badge bg-label-warning me-1">Pending</span>
                            }
                            else if (item.intentionStatus == 1)
                            {
                                <span class="badge bg-label-info me-1">Scheduled</span>
                            }
                            else if (item.intentionStatus == 2)
                            {
                                <span class="badge bg-label-success me-1">Complete</span>
                            }
                        </td>
                        <td>
                            <button type="button" class="btn btn-outline-success" onclick="CompleteIntention(@item.intentionId)">Complete</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="CancelIntention(@item.intentionId)">Cancel</button>
                            <button type="button" class="btn btn-outline-danger" onclick="confirmDelete(@item.intentionId)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<br />
<br />
@*Complete*@
<div class="card">
    <h5 class="card-header">Completed Intentions</h5>
    <div class="table-responsive text-nowrap">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Offered By</th>
                    <th>Intention Type</th>
                    <th>Intention Date</th>
                    <th>Mass Time</th>
                    <th>Intention Details</th>
                    <th>Status</th>
                    <th>Action</th>

                </tr>
            </thead>
            <tbody class="table-border-bottom-0">
                @foreach (var item in Model.Where(m => m.intentionStatus == 2))
                {
                    <tr>
                        <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>@Html.DisplayFor(modelItem => item.offeredBy)</strong></td>
                        <td>
                            @if (item.intentionType == 1)
                            {
                                <span>Souls</span>
                            }
                            else if (item.intentionType == 2)
                            {
                                <span>Thanksgiving</span>
                            }
                            else if (item.intentionType == 3)
                            {
                                <span>Healing</span>
                            }
                        </td>
                        <td>@Html.DisplayFor(modelItem => item.intentionDate)</td>
                        <td>@Html.DisplayFor(modelItem => item.massTime)</td>
                        <td>@Html.DisplayFor(modelItem => item.intentionDetails)</td>
                        <td>
                            @if (item.intentionStatus == 0)
                            {
                                <span class="badge bg-label-warning me-1">Pending</span>
                            }
                            else if (item.intentionStatus == 1)
                            {
                                <span class="badge bg-label-info me-1">Scheduled</span>
                            }
                            else if (item.intentionStatus == 2)
                            {
                                <span class="badge bg-label-success me-1">Complete</span>
                            }
                        </td>
                        <td>
                            <button type="button" class="btn btn-outline-danger" onclick="confirmDelete(@item.intentionId)">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function CancelIntention(intentionId) {
        $.ajax({
            url: '/Admin/CancelIntentions', // Replace ControllerName with your actual controller name
            type: 'POST',
            data: { intentionId: intentionId },
            success: function (response) {
                if (response.success) {
                    // Reload the page or update UI as needed
                    location.reload(); // Reload the page for simplicity
                } else {
                    alert('Failed to accept intention.'); // Show error message if failed
                }
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText); // Log error to console
                alert('Failed to accept intention.'); // Show error message
            }
        });
    }

    function CompleteIntention(intentionId) {
        $.ajax({
            url: '/Admin/CompleteIntentions', // Replace ControllerName with your actual controller name
            type: 'POST',
            data: { intentionId: intentionId },
            success: function (response) {
                if (response.success) {
                    // Reload the page or update UI as needed
                    location.reload(); // Reload the page for simplicity
                } else {
                    alert('Failed to accept intention.'); // Show error message if failed
                }
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText); // Log error to console
                alert('Failed to accept intention.'); // Show error message
            }
        });
    }

    function AcceptIntentions(intentionId) {
        $.ajax({
            url: '/Admin/AcceptIntentions', // Corrected action method name
            type: 'POST',
            data: { intentionId: intentionId },
            success: function(response) {
                if (response.success) {
                    // Reload the page or update UI as needed
                    location.reload(); // Reload the page for simplicity
                } else {
                    alert('Failed to accept intention.'); // Show error message if failed
                }
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText); // Log error to console
                alert('Failed to accept intention.'); // Show error message
            }
        });
    }


    function confirmDelete(intentionId) {
        // Show confirmation dialog or perform any action before deleting
        if (confirm("Are you sure you want to delete this Intention?")) {
            // Create a form dynamically
            var form = document.createElement("form");
            form.method = "post";
            form.action = "/Admin/DeleteIntention";

            // Create an input field for user id
            var userIdInput = document.createElement("input");
            userIdInput.type = "hidden";
            userIdInput.name = "id";
            userIdInput.value = intentionId;

            // Append input field to the form
            form.appendChild(userIdInput);

            // Append form to the document body
            document.body.appendChild(form);

            // Submit the form
            form.submit();
        }
    }
</script>

